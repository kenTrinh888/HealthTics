<!doctype html>
<html lang="en">

<head>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.12.1/css/ol.css" type="text/css">
    <link rel="stylesheet" href="styles/main.css" type="text/css">
    <link rel="stylesheet" href="styles/slidebars.css" type="text/css">
    <script src="http://openlayers.org/en/v3.12.1/build/ol.js" type="text/javascript"></script>
    <script src="bower_components/jquery/dist/jquery.js" type="text/javascript"></script>
    <script src="scripts/main.js" type="text/javascript"></script>
    <script src="scripts/slidebars.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>

<body>
   
    <div class="sb-slidebar sb-left sb-style-push">
        <div style="margin-top:100px">
            <div style="color:white">
                <form id="upload" action="upload.php" method="POST" enctype="multipart/form-data">
                    <fieldset>
                        <input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
                        <div>
                            <label for="fileselect">Files to upload:</label>
                            <input type="file" id="fileselect" name="fileselect[]" multiple="multiple" />
                           <!--  <div id="filedrag">or drop files here</div>
                        </div>
                        <div id="submitbutton">
                            <button type="submit">Upload Files</button>
                        </div> -->
                    </fieldset>
                </form>
            </div>
            <div style="margin-top:20px;color:white">
                Search:
                <input type="text" name="postal code" value="postal code search">
                <br>
            </div>

            <div style="margin-top:20px;color:white"> 
            			<label>Layers:</label>
            	        <div id="layerName"></div>

            </div>
        </div>
    </div>
    <div id="sb-site">
     <h2>My Map</h2>
        <div id="map" class="map">
            <div id="info"></div>
            <li class="sb-toggle-left">Click here for query Builder</li>
            </ul>
        </div>
        <script>
        var layersName = [];
        // var colorsArray = ['blue', 'red', "green"];

        layersName.push("AQUATICSG.kml");
        layersName.push("NATIONALPARKS.kml");
        layersName.push("PLAYSG.kml");
        var layersToBeDisplayed = [];
        var styleCache = {};
        var styleFunction = function() {
            var iconColor = "hsl(" + Math.random() * 360 + ",100%,50%)"
            // console.log(iconColor);
            // var name = feature.get('name');
            // var description = feature.get('description');

            // var colorFilled = colorsArray[colorNumber];
            var radius = 4
            var style = styleCache[radius,iconColor];
            // console.log(colorFilled);
            if (!style) {
                style = new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: radius,
                        fill: new ol.style.Fill({
                            color: iconColor,
                        }),
                        stroke: new ol.style.Stroke({
                            color: iconColor,
                            width: 1
                        })
                    })
                });
                styleCache[radius,iconColor] = style;
            }
            // console.log(style.fill.getColor());
            return style;
        };
        var raster = new ol.layer.Tile({
            source: new ol.source.OSM({
                layer: 'toner'
            })
        });

        layersToBeDisplayed.push(raster);

        for (var i in layersName) {
            var fileName = 'data/' + layersName[i];
            console.log(fileName);
            var aLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    url: fileName,
                    format: new ol.format.KML({
                        extractStyles: false
                    })
                }),
                style: styleFunction()
            });
            // console.log(aLayer.getColor());
            layersToBeDisplayed.push(aLayer);
        }

        var map = new ol.Map({
            target: 'map',
            layers: layersToBeDisplayed,
            view: new ol.View({
                center: ol.proj.fromLonLat([103.851959, 1.31]),
                zoom: 11
            })

        });
        // Tooltip building
        var info = $('#info');

        info.tooltip({
            animation: false,
            trigger: 'manual'
        });

        var displayFeatureInfo = function(pixel) {
            info.css({
                left: pixel[0] + 'px',
                top: (pixel[1] - 15) + 'px'
            });
            var feature = map.forEachFeatureAtPixel(pixel, function(feature, layer) {
                return feature;
            });
            if (feature) {
                info.tooltip('hide')
                    .attr('data-original-title', feature.get('name'))
                    .tooltip('fixTitle')
                    .tooltip('show');
            } else {
                info.tooltip('hide');
            }
        };

        map.on('pointermove', function(evt) {
            if (evt.dragging) {
                info.tooltip('hide');
                return;
            }
            displayFeatureInfo(map.getEventPixel(evt.originalEvent));
        });

        map.on('click', function(evt) {
            displayFeatureInfo(evt.pixel);
        });

        //End tooltip building

        // Start slidebar
        (function($) {
            $(document).ready(function() {
                $.slidebars();
                var input = $('#id1').prop('checked');
                console.log(input);

		  $("#layerList").find('input')
		  .change(function() {
		    var $input = $(this);
		    console.log($input.prop("checked"));
		    console.log($input.val());
		  })
		  .change();

            });
        })(jQuery);

        // End Slidebar

        // List of layers
        $("#layerName").html('<fieldset id="layerList"></fieldset>');

        for (var i = 0; i < layersName.length; i++) {
        	var name = layersName[i];

        	$("#layerList").append('<input type="checkbox" value="' + name + '" id="id' + i + '" checked><label>' + name + '</label></br>');
        }
        


        </script>
</body>

</html>
